@(user: models.FacebookUser, redirectUri: String)(implicit lang: Lang, flash: Flash)

@base("Fullin-Fullout") {
<h1>Fullin-Fullout</h1>
<div>
Hello @user.name
</div>
<h2>Upload</h2>
<form id="uploadForm" action="https://fullin-fullout.s3.amazonaws.com/" method="post" enctype="multipart/form-data">
	<input type="hidden" name="acl" value="private"> 
	<input type="hidden" name="success_action_redirect" value="@redirectUri">
	
	<input type="hidden" name="key" value="">
	<input type="hidden" name="AWSAccessKeyId" value=""> 
	<input type="hidden" name="policy" value="">
	<input type="hidden" name="signature" value="">
	<input type="hidden" name="Content-Type" value="">
	File to upload to S3: 
	<input name="file" type="file"> 
</form> 
<script>
$(function() {
	function fileChanged() {
		var filename = $(this).val();
		if (filename) {
			$.ajax({
				"url" : "/videos/prepareUpload",
				"type" : "post",
				"data" : {
					"filename" : filename
				},
				"success" : function(data) {
					console.log(JSON.stringify(data));
					form.find("input[name='key']").val("videos/" + data.key);
					form.find("input[name='AWSAccessKeyId']").val(data.accessKey);
					form.find("input[name='policy']").val(data.policy);
					form.find("input[name='signature']").val(data.signature);
					form.find("input[name='Content-Type']").val(data.contentType);
					
					form[0].submit();
				}
			});
		}
	}
	var form = $("#uploadForm");
	form.find("input[name='file']").change(fileChanged);
})
</script>
}
